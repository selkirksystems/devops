---
# Based heavily on the Ansible documentation on EC2:
# http://docs.ansible.com/ec2_module.html
  - name: Provision an EC2 node
    hosts: local
    connection: local
    gather_facts: False
    tags: spacecadet
    vars:
      instance_type: t1.micro
      security_group: SK-FMT-WebTier-PROD
      image: ami-5189a661
      region: us-west-2
      keypair: Selkirk-PK
    tasks:
      - name: Launch new Instance
        local_action: ec2 instance_tags="Name=SpaceCadetTest1" group={{ security_group }} instance_type={{ instance_type}} image={{ image }} wait=true region={{ region }} keypair={{ keypair }}
        register: ec2
  
#      - name: Add instance to local host group
#        local_action: lineinfile dest=hosts regexp="{{ item.public_dns_name }}" insertafter="[launched]" line="{{ item.public_dns_name }} ansible_ssh_private_key_file=~/.ssh/{{ keypair }}.pem"
#        with_items: ec2.instances
